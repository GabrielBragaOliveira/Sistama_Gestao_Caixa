<p-toast></p-toast>
<p-confirmDialog></p-confirmDialog>

<p-dialog [(visible)]="abrirCadastro" [modal]="true" [draggable]="false" [resizable]="false" [closable]="false" styleClass="dialog-cadastro-transparente">
  <app-cadastro-usuario [id]="idEditando" [isEdicao]="isEdicao" (fechar)="onFormularioFechado()"></app-cadastro-usuario>
</p-dialog>

<div class="pesquisaBar">
  <div class="filters">
    <span class="p-input-icon-left">
      <i class="pi pi-search"></i>
      <input pInputText type="text" [(ngModel)]="filtroString" placeholder="Buscar por Nome ou E-mail"
        (input)="onFiltroStringChange()" />
    </span>

    <p-selectButton [options]="statusOptionsAtivo" optionLabel="label" optionValue="value" [(ngModel)]="filtroAtivo"
      (onChange)="onFiltroChange()">
    </p-selectButton>

    <p-selectButton [options]="statusOptionsPerfil" optionLabel="label" optionValue="value" [(ngModel)]="filtroPerfil"
      (onChange)="onFiltroChange()">
    </p-selectButton>

    <button pButton label="Limpar" class="p-button-secondary" (click)="limparFiltros()"></button>
  </div>

  <button pButton label="Novo Usuario" class="p-button-success" (click)="novo()"></button>
</div>

<p-table [value]="usuarios" [paginator]="true" [rows]="10" [loading]="service.loading()"
  [tableStyle]="{'table-layout': 'fixed', 'width': '100%'}">
  <ng-template pTemplate="header">
    <tr>
      <th>Nome</th>
      <th>Email</th>
      <th>Perfil</th>
      <th>Status</th>
      <th style="width: 220px;">Ações</th>
    </tr>
  </ng-template>
  <ng-template pTemplate="body" let-users>
    <tr>
      <td>{{ users.nome }}</td>
      <td>{{ users.email }}</td>
      <td>{{ users.perfil }}</td>
      <td>
        <p-tag [severity]="users.ativo ? 'success' : 'danger'" [value]="users.ativo ? 'Ativo' : 'Inativo'"></p-tag>
      </td>
      <td>
        <button pButton label="Editar" icon="pi pi-pencil" (click)="editar(users.id)"
          [disabled]="(!users.ativo || (users.id == auth.getUsuarioLogado()?.id))"
          class="p-button-text p-button-info"></button>
        <button pButton label="Inativar" icon="pi pi-ban" class="p-button-danger p-button-text"
          (click)="confirmarInativacao(users)"
          [disabled]="(!users.ativo || (users.id == auth.getUsuarioLogado()?.id))"></button>
      </td>
    </tr>
  </ng-template>
</p-table>

<div class="summary">
  Total: {{ usuarios.length }}
</div>