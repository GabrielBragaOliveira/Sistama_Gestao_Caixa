<p-toast></p-toast>
<p-confirmDialog></p-confirmDialog>

<div class="pesquisaBar">
  <div class="filters">
    <span>
      <label>Pesquisa:</label>
      <input pInputText type="text" [(ngModel)]="filtroString" placeholder="Codigo , Nomes Ou Categoria" (input)="onFiltroStringChange()" />
    </span>

    <span>
      <label>Status:</label>
      <p-selectButton
        [options]="statusOptionsAtivo"
        optionLabel="label"
        optionValue="value"
        [(ngModel)]="filtroAtivo"
        (onChange)="carregar()">
      </p-selectButton>
    </span>

    <button pButton label="Limpar" class="p-button-secondary" (click)="limparFiltros()"></button>
  </div>

  <button pButton label="Novo Produto" class="p-button-success" (click)="novo()"></button>
</div>

<p-table [value]="produtos" [paginator]="true" [rows]="10" [loading]="service.loading() "[tableStyle]="{'table-layout': 'fixed', 'width': '100%'}" >
  <ng-template pTemplate="header">
    <tr>
      <th>Codigo</th>
      <th>Nome</th>
      <th>Categoria</th>
      <th>Quantidade</th>
      <th>Valor Unitario</th>
      <th>Status</th>
      <th style="width: 220px;">Ações</th>
    </tr>
  </ng-template>
  <ng-template pTemplate="body" let-produto>
    <tr>
      <td>{{ produto.codigo }}</td>
      <td>{{ produto.nome }}</td>
      <td>{{ produto.categoria }}</td>
      <td>{{ produto.quantidadeEstoque }}</td>
      <td>{{ produto.preco | currency:'BRL':'symbol':'1.2-2' }}</td>
      <td>
        <p-tag [severity]="produto.ativo ? 'success' : 'danger'" [value]="produto.ativo ? 'Ativo' : 'Inativo'"></p-tag>
      </td>
      <td>
        <button pButton label="Editar" icon="pi pi-pencil" (click)="editar(produto.id)"[disabled]="!produto.ativo"class="p-button-text p-button-info" ></button>
        <button pButton label="Inativar" icon="pi pi-ban" class="p-button-danger p-button-text" (click)="confirmarInativacao(produto)" [disabled]="!produto.ativo"></button>
      </td>
    </tr>
  </ng-template>
</p-table>

<div class="summary">
  Total: {{ produtos.length }}
</div>

<p-dialog 
  [(visible)]="abrirCadastro" 
  [modal]="true" 
  [draggable]="false" 
  [resizable]="false"
  [closable]="false"
  (onHide)="onFormularioFechado(false)"> 
    <app-cadastro-estoque
      [id]="idEditando"
      [isEdicao]="isEdicao"
      (fechar)="onFormularioFechado($event)"
    ></app-cadastro-estoque>
</p-dialog>